bundle:
  name: shopstream_dbx
  uuid: c7507e03-d183-4096-bfa2-7db420cd79ef
  git:
    origin_url: https://github.com/RobcPeng/shopstream_dbx.git

include:
  - resources/*.yml
  - resources/*/*.yml

artifacts:
  python_artifact:
    type: whl
    build: uv build --wheel

variables:
  catalog:
    description: The catalog to use
  schema:
    default: bronze
    description: The schema to use
  node_type_id:
    description: Instance type for compute
  num_workers:
    description: Number of workers
  availability:
    description: Cluster availability
  spark_version:
    description: Databricks runtime version
  use_photon:
    description: Whether to use Photon acceleration

targets:
  dev:
    git:
      branch: dev
    mode: development
    default: true
    workspace:
      host: https://dbc-9bb4ffe7-f810.cloud.databricks.com
      root_path: ~/.bundle/${bundle.target}/${bundle.name}
    variables:
      catalog: shopstream_dev
      schema: bronze
      node_type_id: "i3.xlarge"
      num_workers: 1
      availability: "SPOT"
      spark_version: "16.4.x-scala2.12"
      use_photon: false

  stage:
    git:
      branch: dev
    mode: development
    workspace:
      host: https://dbc-f6c570d2-5aca.cloud.databricks.com
      root_path: ~/.bundle/${bundle.target}/${bundle.name}
    variables:
      catalog: shopstream_stage
      schema: bronze
      node_type_id: "i3.xlarge"
      num_workers: 2
      availability: "SPOT_WITH_FALLBACK"
      spark_version: "16.4.x-scala2.12"
      use_photon: false
  prod:
    git:
      branch: main
    mode: production
    workspace:
      host: https://dbc-f6c570d2-5aca.cloud.databricks.com
      root_path: /Workspace/Shared/${bundle.name}/${bundle.target}
    variables:
      catalog: shopstream_prod
      schema: bronze
      node_type_id: "i3.2xlarge"
      num_workers: 4
      availability: "ON_DEMAND"
      spark_version: "16.4.x-photon-scala2.12"
      use_photon: true
